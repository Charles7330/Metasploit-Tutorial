# Handlers With Example Scenario

- Similar to exploits using a reverse shell, you will need to be able to accept incoming connections generated by the MSFvenom payload. 

- When using an exploit module, this part is ***automatically*** handled by the ***exploit*** module, you will remember how the `payload options` title appeared when setting a ***reverse shell***. 

- The term commonly used to receive a connection from a target is `'catching a shell'`. 

- ***Reverse shells*** or ***Meterpreter callbacks*** generated in your MSFvenom payload can be easily caught using a **handler**.


# Example Scenario

- We will exploit the ***file upload vulnerability** present in `DVWA` (Damn Vulnerable Web Application). 

- In this task, you will need to replicate a similar scenario on another target system, DVWA was used here for illustration purposes.

- There are a few steps to follow to execute the exploitation:

## Step 1 - Generate the PHP Shell using Msfvenom

- MSFvenom will require `a payload`, the `local machine IP` address, and the `local port` to which the payload will connect. 

- Seen below, ***10.0.2.19*** is the IP address of a Kali Linux machine used in the attack and local port ***7777*** was chosen.

  ![image](https://user-images.githubusercontent.com/63872951/187034257-80624ca9-59c1-460d-8a3c-a75a9958a3b9.png)

- **Please note: The output PHP file will miss the starting PHP tag commented and the end tag (?>), as seen below**.

  ![image](https://user-images.githubusercontent.com/63872951/187034287-9be01f8a-b2f7-4a50-ac65-e701656e32d4.png)

- The `reverse_shell.php` file should be edited to convert it into a working PHP file. 

- **Below: Comments removed from the beginning of the file**.

  ![image](https://user-images.githubusercontent.com/63872951/187034347-fd3340b1-3068-45d8-b4a5-41a971c6e1f4.png)

- **Below: End tag added**

  ![image](https://user-images.githubusercontent.com/63872951/187034371-528309fb-828a-4b29-b6a6-eea6bb4b6ab2.png)


## Step 2 - Start the Metasploit Handler

- We will use ***Multi Handler*** to receive the incoming connection. The module can be used with the `use exploit/multi/handler` command.

- Multi handler supports all Metasploit payloads and can be used for Meterpreter as well as regular shells.

- To use the module, we will need to ***set*** the payload value (`php/reverse_php` in this case), the `LHOST`, and `LPORT` values. 

  ![image](https://user-images.githubusercontent.com/63872951/187034464-a76afd54-6ac4-461c-8ee7-b1933b5a4b9f.png)


## Step 3 - Execute the PHP Shell

- Once everything is set, we will `run` the handler and wait for the incoming connection. 
  
  ![image](https://user-images.githubusercontent.com/63872951/187034488-bfa3ac7d-1921-4865-b358-be6f11309ccd.png)

- When the reverse shell is triggered, the connection will be received by `multi/handler` and provide us with a shell.

- If the payload was set as Meterpreter (e.g. in a ***Windows executable format***), `multi/handler` would then provide us with a Meterpreter shell. 
  
  
- **[Continue](https://github.com/ShubhamJagtap2000/Metasploit/tree/main/09%20-%20msfvenom/04%20-%20Other%20Payloads)**
  
